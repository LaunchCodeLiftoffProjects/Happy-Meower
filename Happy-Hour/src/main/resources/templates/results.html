<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head th:replace="fragments :: head">
</head>
<title th:text="${title}"></title>
<body >
<div class="bg">
    <div class="container h-100">
        <div class="d-flex justify-content-center h-100">
            <div class="container body-content">
                <div class="page-header text-center my-5">
                    <h1>Happy Hour Locator</h1>
                </div>
                <div class="navbar-header d-flex justify-content-flex-start text-center mb-4">
                    <a th:href="@{/}" class="navbar-brand m-0 px-1 border">Home</a>
                    <p th:text="${title}" class="navbar-brand m-0 w-100 border"></p>
                </div>
                <h2 class = "centered">Happy Hours with </h2>
                <h2 class="centered" th:text="${searchTerm}"></h2>
                <table class="table">
                    <thead>
                    <tr>
                        <th>Happy Hours</th>
                    </tr>
                    </thead>
                    <tr>
                        <th> Name </th>
                        <th> Address </th>
                        <th> Times </th>
                    </tr>
                    <tbody>
                    <th:block th:each="happy : ${happyHours}">
                        <tr>
                            <td th:text="${happy.name}" ></td>
                            <td th:text="${happy.address}" ></td>
                            <td th:text="${happy.startTime}+' - '+${happy.endTime}" ></td>
                        </tr>
                    </th:block>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!--The div element for the map -->
<div id="map" style="width:1000px; height: 500px; margin: auto auto 100px;"><!--MAP GOES HERE--></div>
<script th:inline="javascript">
  var geocoder;
  var map;

  /*<![CDATA[*/
    var addressList = /*[[${addressList}]]*/;
  /*]]>*/

  function initMap() {
    geocoder = new google.maps.Geocoder();

    map = new google.maps.Map(document.getElementById('map'), {
    zoom: 15,
    mapTypeId: 'roadmap'
    });

    var bounds = new google.maps.LatLngBounds();

    function geocodeAddressesAndMarkAndCenter(addressList){
        for (var i = 0; i < addressList.length; i++) {
            geocoder.geocode( { 'address': addressList[i]}, function(results, status) {
                if (status == 'OK') {
                    var marker = new google.maps.Marker({
                        map: map,
                        position: results[0].geometry.location
                    });
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }

                bounds.extend(results[0].geometry.location);
                map.fitBounds(bounds);
                if(map.zoom > 15) {
                    map.setZoom(15);
                }
            });
        }
    }

    geocodeAddressesAndMarkAndCenter(addressList);

  }

</script>
<script th:inline="javascript" async="async" defer="defer"
        src=REDACTED>
</script>  <!--This script verifies Google API Key, establishes link with registered API products, and initialize Map Script-->
</body>
</html>